本次实习的目标是设计代码评测网站的数据库，包括列举业务需求、设计ER图、将ER图转换为关系表、用SQL语句实现业务功能。

## 一、业务需求

代码评测网站以代码提交和评测为主要功能，在此之外，我们还实现了发布帖子和评论的功能。

- **代码提交:**用户可以针对题目提交代码，提交的代码会被上传数据库，以供后续评测。
- **代码评测:**用户提交代码后，系统从数据库获取时间空间限制和测试用例并进行评测，评测结果会被上传数据库并可供用户查询。
- **论坛:**用户可以针对问题发布帖子，帖子会被上传数据库。用户也可以对已发布帖子进行评论。

## 二、ER图设计
根据上述业务需求，确定实体及实体间的联系

### 1. 实体
共设立六种实体，并确定它们各自的属性（主码用下划线来标识）
- **用户(User)** （<u>用户id</u>，用户名，密码，等级）
- **题目(Problem)** （<u>题目id</u>，题目名，作者id，发布时间，题目描述，难度，时间限制，内存限制）
- **提交(Submission)** （<u>提交id</u>，用户id，题目id，提交时间，代码，编程语言，状态，分数）
- **帖子(Post)** （<u>帖子id</u>，标题，作者id，问题id，发布时间，内容）
- **评论(Comment)** （<u>评论id</u>，帖子id，评论者id，评论时间，内容）

以上五种均为强实体，而对于输入输出对，它依赖于题目，因此将其设置为弱实体。
- **输入输出对(IOpair)** （<u>题目id，输入输出对id</u>，输入，输出，得分，类型）

### 2. 联系
实体之间存在如下的联系：
#### 由用户发出的一对多联系：
- **出题**：用户-题目之间的一对多联系。用户可以出题，一个用户可以出多道题目，一个题目只能由一个用户出。
- **写入**：用户-提交之间的一对多联系。用户可以写入提交，一个用户可以提交多次，一次提交只能由一个用户写入。
- **发帖**：用户-帖子之间的一对多联系。
- **发表评论**：用户-评论之间的一对多联系。
#### 题目评测过程中发生的联系：
- **给**：题目-提交之间的一对多联系。提交被传给特定题目进行评测。
- **包含**：题目-输入输出对之间的一对多联系。输入输出对是对提交正确性进行评测的依据。
- **测试点**：输入输出对-提交之间的多对多联系。一个提交可以被多个输入输出对评测，一个输入输出对可以评测多个提交。
#### 论坛中发生的联系：
- **跟帖**：帖子-评论之间的一对多联系。一个帖子下可以有多条评论，一条评论只能属于一个帖子。

### 3. ER图
根据列出的实体和联系，绘制ER图如下：

## 三、关系表创建
完成ER图设计后，我们将ER图转换为关系表。
6个实体各自对应一张表，弱实体所对应的表中有外键指向其依赖的强实体。
测试点(Checkpoint)作为多对多联系，需要新建一张表来存储。
其余联系均为一对多联系，不需要单独创建表，而是在多的一方添加外键指向一的一方。

